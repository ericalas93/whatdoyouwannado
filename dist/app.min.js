var wdywdApp=angular.module("wdywdApp",["ngRoute","ngMessages","angular-jwt"]).config(["$routeProvider","$locationProvider","$httpProvider",function(a,b,c){a.when("/",{templateUrl:"partials/home.html",controller:"mainController",title:"Home"}).when("/suggestion",{templateUrl:"partials/suggestion.html",controller:"suggestionController",title:"Get Suggestion",resolve:{getSuggestionList:["$q","ManipulateSuggestion",function(a,b){var c=a.defer(),d={tableName:void 0===localStorage.username?"default_suggestion":localStorage.username};return b.getSuggestion(d).then(function(a){c.resolve(a)}),c.promise}],getCurrentConditions:["$q","Weather",function(a,b){var c=a.defer();return b.getLocation().then(function(){b.getCurrentWeather().then(function(a){c.resolve(a)})}),c.promise}]}}).when("/login",{templateUrl:"partials/login.html",controller:"loginController",title:"Login or Sign Up"}).when("/newsuggestion",{templateUrl:"partials/newsuggestion.html",controller:"newSuggestionController",title:"Create Suggestion"}).when("/dashboard",{templateUrl:"partials/user.html",controller:"userController",title:"Dashboard",resolve:{confirmLoggedIn:["$q","UserAuthentication",function(a,b){var c=a.defer(),d={token:localStorage.jwt};return b.userLoggedIn(d).success(function(a){c.resolve()}),c.promise}],getCustomSuggestions:["$q","ManipulateSuggestion",function(a,b){var c=a.defer(),d={tableName:localStorage.username};return b.getSuggestion(d).then(function(a){c.resolve(a)}),c.promise}]}}).when("/modify/:id",{templateUrl:"partials/editsuggestions.html",controller:"editSuggestionController",title:"Modify Suggestion",resolve:{getCustomSuggestion:["$q","ManipulateSuggestion","$route",function(a,b,c){var d=a.defer(),e=void 0!==localStorage.username?{tableName:localStorage.username}:{tableName:"default_suggestion"};return e.id=c.current.params.id,b.getSuggestion(e).then(function(a){d.resolve(a)}),d.promise}]}}),b.html5Mode({enabled:!0,requireBase:!1}),c.interceptors.push(["$rootScope","$q","$location",function(a,b,c){return{response:function(a){return a},responseError:function(d){return 401===d.status&&(a.$broadcast("401error"),c.path("/login")),b.reject(d)}}}])}]),wdywd=angular.module("wdywdApp").controller("editSuggestionController",["$rootScope","$route","$scope","$routeParams","$location","$timeout","getCustomSuggestion","ManipulateSuggestion",function(a,b,c,d,e,f,g,h){c.showName=d.id,a.pageTitle=b.current.title,c.suggestion=g[0],c.init=function(){c.token=localStorage.jwt,c.idea={name:c.suggestion.suggestion_name,category:c.suggestion.suggestion_category,price:c.suggestion.suggestion_price,acceptableTime:c.suggestion.suggestion_time,acceptableTemperature:c.suggestion.suggestion_temperature},c.conditionSelection=c.suggestion.suggestion_weather.split(", ")},c.init(),c.category={availableOptions:[{name:"Misc"},{name:"Sport"},{name:"Entertainment"},{name:"Casual"},{name:"Social"}],selectedOption:{name:c.suggestion.suggestion_category}},c.acceptableTime={availableOptions:[{name:"Both"},{name:"Day"},{name:"Night"}],selectedOption:{name:"Both"}},c.acceptableTemperature={availableOptions:[{description:"Any Temperature",name:"DNA"},{description:"Hot (greater than 80F)",name:"Hot"},{description:"Mild (between 50F and 79F",name:"Mild"},{description:"Cold (less than 50F)",name:"Cold"}],selectedOption:{description:"Any Temperature",name:"DNA"}},c.save=function(){c.newIdea=angular.copy(c.idea),c.newIdea.category=c.category.selectedOption.name,c.newIdea.acceptableTime=c.acceptableTime.selectedOption.name,c.newIdea.acceptableTemperature=c.acceptableTemperature.selectedOption.name,c.newIdea.acceptableCondition=void 0===c.conditionSelection?"All":c.conditionSelection.join(", "),console.log(c.newIdea.acceptableCondition),c.settingTouched(!1),c.postNewIdea()},c.relocate=function(){f(function(){e.path("/dashboard")},3e3)},c.postNewIdea=function(){c.newIdea.jwt=c.token,c.newIdea.username=c.username,c.newIdea.suggestionId=c.suggestion.id,h.updateSuggestion(c.newIdea).then(function(a){"1"===a.data?(c.isItSubmitted=!0,c.relocate()):(console.log(a),c.unsuccessfulSubmit=!0)})},c.confirm=function(){c.suggestionForm.$valid?c.save():c.settingTouched(!0)},c.settingTouched=function(a){a?angular.forEach(c.suggestionForm.$error,function(a){angular.forEach(a,function(a){a.$setTouched()})}):c.suggestionForm.$setUntouched()}}]),wdywd=angular.module("wdywdApp").controller("mainController",["$rootScope","$route","$scope","$location",function(a,b,c,d){c.message="Home Page",a.pageTitle=b.current.title,c.routeSuggestion=function(){d.path("/suggestion")}}]),wdywd=angular.module("wdywdApp").controller("loginController",["$rootScope","$route","$scope","$location","UserAuthentication","jwtHelper",function(a,b,c,d,e,f){a.pageTitle=b.current.title,c.init=function(){c.loginInfo={username:a.loggingInUsername,password:void 0},c.loginControllerError=a.loginControllerError,c.localStorageUsername=localStorage.username,void 0!==c.localStorageUsername&&(c.token={token:localStorage.jwt},e.userLoggedIn(c.token).success(function(a){d.path("/dashboard")}))},c.init(),c.message="Login/signup page",c.newUser={},c.loggedInUser={},c.signUpUser=function(){c.newUser=angular.copy(c.newUserForm),e.postNewUser(c.newUser).success(function(a){console.log(a),"fail"==a||"taken"==a?c.userNameTaken=!0:(c.userNameTaken=!1,localStorage.setItem("jwt",a),localStorage.setItem("username",c.newUser.username),d.path("/dashboard"))}).error(function(a){d.path("/login")})},c.loginUser=function(){void 0!==c.loginInfo.username&&void 0!==c.loginInfo.password&&(c.loggedInUser=angular.copy(c.loginInfo),a.loggingInUsername=c.loggedInUser.username,e.logInUser(c.loggedInUser).success(function(a){"no such user"==a||"fail"==a?d.path("/dashboard"):(localStorage.setItem("jwt",a),localStorage.setItem("username",c.loggedInUser.username),d.path("/dashboard"))}).error(function(a){d.path("/login")}))}}]).run(["$rootScope",function(a){a.$on("401error",function(){a.loginControllerError=!0})}]),wdywd=angular.module("wdywdApp").controller("newSuggestionController",["$rootScope","$route","$scope","ManipulateSuggestion","UserAuthentication","jwtHelper",function(a,b,c,d,e,f){c.newIdea={},c.isItSubmitted=!1,a.pageTitle=b.current.title,c.init=function(){c.token=localStorage.jwt,c.tokenRequest={token:c.token},e.userLoggedIn(c.tokenRequest).success(function(a){c.tokenDecoded=f.decodeToken(c.token),c.username=c.tokenDecoded.username}).error(function(b){a.userLoggingIn=b})},c.init(),c.category={availableOptions:[{name:"Misc"},{name:"Sport"},{name:"Entertainment"},{name:"Social"}],selectedOption:{name:"Misc"}},c.acceptableTime={availableOptions:[{name:"Both"},{name:"Day"},{name:"Night"}],selectedOption:{name:"Both"}},c.acceptableTemperature={availableOptions:[{description:"Any Temperature",name:"DNA"},{description:"Hot (greater than 80F)",name:"Hot"},{description:"Mild (between 50F and 79F",name:"Mild"},{description:"Cold (less than 50F)",name:"Cold"}],selectedOption:{description:"Any Temperature",name:"DNA"}},c.conditionSelection=["All"],c.save=function(a){c.newIdea=angular.copy(a),c.newIdea.category=c.category.selectedOption.name,c.newIdea.acceptableTime=c.acceptableTime.selectedOption.name,c.newIdea.acceptableTemperature=c.acceptableTemperature.selectedOption.name,c.newIdea.acceptableCondition=void 0===c.conditionSelection?"All":c.conditionSelection.join(", "),c.settingTouched(!1),c.postNewIdea()},c.reset=function(){c.idea.name="",c.idea.price="",c.category.selectedOption={name:"Misc"},c.acceptableTime.selectedOption={name:"Both"},c.acceptableTemperature.selectedOption={description:"Any Temperature",name:"DNA"}},c.postNewIdea=function(){c.newIdea.jwt=c.token,c.newIdea.username=c.username,d.postSuggestion(c.newIdea).then(function(a){console.log(a),"11"===a.data?(c.isItSubmitted=!0,c.unsuccessfulSubmit=!1,c.reset()):(c.unsuccessfulSubmit=!0,c.isItSubmitted=!1)})},c.confirm=function(a){c.suggestionForm.$valid?c.save(a):c.settingTouched(!0)},c.settingTouched=function(a){a?angular.forEach(c.suggestionForm.$error,function(a){angular.forEach(a,function(a){a.$setTouched()})}):c.suggestionForm.$setUntouched()}}]),wdywd=angular.module("wdywdApp").controller("suggestionController",["$rootScope","$route","$scope","ManipulateSuggestion","UserAuthentication","getSuggestionList","getCurrentConditions",function(a,b,c,d,e,f,g){c.message="Get a suggestion!",a.pageTitle=b.current.title,c.listOfSuggestions=[],c.resultSuggestions={},c.numberOfSuggestions=0,c.validCondition=function(a){var b=a.suggestion_weather.split(", ");if(b.indexOf(!0))return!0;var d=b.map(function(a){return a==c.currentCondition?!0:!1});return-1!==d.indexOf(!0)?!0:!1},c.generalizeCondition=function(a){return a>=200&&531>=a?"Rain":a>=600&&622>=a?"Snow":a>=800&&804>=a||a>=951&&955>=a?"Clear":"Other"},c.init=function(){c.resultSuggestions=f,c.localStorageUsername=localStorage.username,void 0!==c.localStorageUsername?(c.token={token:localStorage.jwt},e.userLoggedIn(c.token).success(function(a){"1"===a?c.usernameTableName=c.localStorageUsername:c.usernameTableName="default_suggestion"})):c.usernameTableName="default_suggestion",c.currentTemperature=g.main.temp,c.currentCondition=c.generalizeCondition(g.weather[0].id),c.currentHour=(new Date).getHours(),c.locationPermission=JSON.parse(localStorage.locationPermission)},c.init(),c.containsId=function(a,b){var c=0;for(c=0;c<a.length;++c)if(a[c].id===b.id)return!0;return!1},c.getRandomId=function(a,b){return Math.floor(Math.random()*(b-a))+a},c.validTime=function(a){return"Both"===a.suggestion_time?!0:c.currentHour>=18&&c.currentHour<=24||c.currentHour>=0&&c.currentHour<=4?"Night"===a.suggestion_time?!0:!1:"Day"===a.suggestion_time?!0:!1},c.validTemperature=function(a){return"DNA"===a.suggestion_temperature?!0:c.currentTemperature>=80?"Hot"===a.suggestion_time?!0:!1:c.currentTemperature>=50&&c.currentTemperature<80?"Mild"===a.suggestion_time?!0:!1:c.currentTemperature<50?"Cold"===a.suggestion_time?!0:!1:void 0},c.getSuggestion=function(){var a;if(c.locationPermission===!0)for(var b=[],d=c.resultSuggestions.length;b.length<d;){if(a=c.getRandomId(0,d),c.validTime(c.resultSuggestions[a])&&c.validTemperature(c.resultSuggestions[a])&&c.validCondition(c.resultSuggestions[a])){c.listOfSuggestions.push(c.resultSuggestions[a]),c.resultSuggestions.splice(a,1);break}c.containsId(b,c.resultSuggestions[a])||b.push(c.resultSuggestions[a])}else a=c.getRandomId(0,d),c.listOfSuggestions.push(c.resultSuggestions[a]),c.resultSuggestions.splice(a,1);var e=c.resultSuggestions.map(function(a){return c.validTime(a)&&c.validTemperature(a)&&c.validCondition(a)?!0:!1});-1===e.indexOf(!0)&&(c.limitMessage="You have exhausted all your suggestions!",c.limitButtonDisable=!0)}}]),wdywd=angular.module("wdywdApp").controller("userController",["$rootScope","$route","$scope","$location","ManipulateSuggestion","jwtHelper","getCustomSuggestions","ManipulateSuggestion",function(a,b,c,d,e,f,g,e){c.userSuggestions={},a.pageTitle=b.current.title,c.init=function(){var b=localStorage.jwt;c.tokenDecoded=f.decodeToken(b),c.username=c.tokenDecoded.username,"invalidnull"===g?c.userSuggestions=[]:c.userSuggestions=angular.copy(g),a.loginControllerError=!1},c.init(),c.editSuggestion=function(a){d.path("/modify/"+a)},c.newSuggestion=function(a){d.path("/newsuggestion")},c.confirmDelete=function(a,b){alert(b+" has been deleted from your list of suggestions.");for(var d=0;d<c.userSuggestions.length;++d)if(c.userSuggestions[d].id===a){!function(a){c.$apply(function(){c.userSuggestions.splice(a,1)})}(d);break}var f={suggestion_id:a,tableName:c.username,jwt:localStorage.jwt};e.deleteSuggestion(f).then(function(a){})}}]),wdywd=angular.module("wdywdApp").directive("ngConfirmDelete",[function(){return{link:function(a,b,c){var d=c.ngConfirmDelete||"Are you sure?",e=c.confirmedDelete;b.bind("click",function(b){window.confirm(d)&&a.$eval(e)})}}}]),wdywd=angular.module("wdywdApp").directive("navBar",["$location",function(a){return{restrict:"E",templateUrl:"partials/navbar.html",link:function(b,c,d,e){b.username=void 0===localStorage.username?"Guest":localStorage.username,b.loggedIn=void 0===localStorage.username?!1:!0,b.logout=function(){localStorage.clear(),a.path("/login")}}}}]),wdywd=angular.module("wdywdApp").factory("HTTPInterceptor",["$rootScope","$q","location",function(a,b,c){return{response:function(a){return console.log(a),a},responseError:function(d){return 401===d.status&&(a.broadcast("401response"),console.log("errir"),c.path("/login")),b.reject(d)}}}]),wdywd=angular.module("wdywdApp").factory("ManipulateSuggestion",["$http","$q",function(a,b){return{getSuggestion:function(c){var d=b.defer();return a.get("php/suggestions.php?action=get_suggestion",{params:c}).success(function(a){d.resolve(a)}),d.promise},postSuggestion:function(b){return a.post("php/suggestions.php?action=post_suggestion",b)},updateSuggestion:function(b){return a.post("php/suggestions.php?action=edit_suggestion",b)},deleteSuggestion:function(c){var d=b.defer();return a["delete"]("php/suggestions.php?action=delete_suggestion",{params:c}).success(function(a){d.resolve(a)}),d.promise}}}]),wdywd=angular.module("wdywdApp").factory("UserAuthentication",["$http","$q",function(a,b){return{postNewUser:function(b){return a.post("php/authentication.php?action=create_user",b)},logInUser:function(b){return a.post("php/authentication.php?action=login_user",b)},userLoggedIn:function(b){return a.post("php/authentication.php?action=check_log",b)}}}]),wdywd=angular.module("wdywdApp").factory("Weather",["$q","$http","$window",function(a,b,c){return{getCurrentWeather:function(){var c=a.defer(),d=localStorage.latitude,e=localStorage.longitude,f="http://api.openweathermap.org/data/2.5/weather?lat="+d+"&lon="+e+"&appid=2de143494c0b295cca9337e1e96b00e0&units=imperial";return b.get(f).success(function(a){c.resolve(a)}),c.promise},getLocation:function(){var b=a.defer();return void 0==localStorage.locationPermission?(localStorage.setItem("locationPermission",!1),localStorage.setItem("locationAskedOnce",!1),c.navigator.geolocation.getCurrentPosition(function(a){localStorage.longitude=a.coords.longitude,localStorage.latitude=a.coords.latitude,localStorage.locationPermission=!0,localStorage.locationAskedOnce=!0,b.resolve(a)})):b.resolve(),b.promise}}}]);